%%{init: {
  'theme': 'neutral',
  'themeVariables': {
    'primaryColor': '#f0f4f8',
    'primaryTextColor': '#333',
    'primaryBorderColor': '#8fa7b8',
    'lineColor': '#8fa7b8',
    'secondaryColor': '#f8f0f4',
    'tertiaryColor': '#f4f8f0',
    'fontFamily': 'Trebuchet MS, Arial, sans-serif',
    'fontSize': '12px'
  }
}}%%

graph TD
    classDef default fill:#fff,stroke:#8fa7b8,stroke-width:1px;
    classDef entrypoint fill:#e6f3ff,color:#333,stroke:#3498db,stroke-width:2px;
    classDef config fill:#f9efd4,color:#333,stroke:#d4b26a;
    classDef core fill:#d4e6f1,color:#333,stroke:#7fb3d5;
    classDef agent fill:#d5f5e3,color:#333,stroke:#82e0aa;
    classDef message fill:#fdebd0,color:#333,stroke:#f5b041;
    classDef factory fill:#e8daef,color:#333,stroke:#bb8fce;
    classDef strategy fill:#d6eaf8,color:#333,stroke:#85c1e9;
    classDef util fill:#f2d7d5,color:#333,stroke:#e6b0aa;

    A[run.py] -->|uses| B[Pipeline]
    A -->|uses| C[TravelPlannerAgent]
    A -->|uses| D[Message]
    
    subgraph Agents["Agents"]
        C -->|manages| E[FlightAgent]
        C -->|manages| F[HotelAgent]
        C -->|manages| G[CarRentalAgent]
        J[Agent]
    end
    
    E & F & G -.->|extends| J
    
    B -->|contains| C
    
    subgraph Core["Core"]
        H[TemplateManager]
        I[ResponseGenerator]
    end
    
    C -->|uses| H
    C -->|uses| I
    E & F & G -->|use| H
    E & F & G -->|use| I
    
    subgraph Factories["Factories"]
        K[Generation<br>Strategy<br>Factory]
        L[Model<br>Factory<br>Provider]
        M[Default<br>Generation<br>Strategy]
        N[VertexAI<br>Model<br>Factory]
    end
    
    I -->|uses| K
    I -->|uses| L
    K -.->|creates| M
    L -.->|creates| N
    
    O[StateManager] -.->|used by| C
    P[io.py] -.->|used by| H

    class A entrypoint;
    class H,I core;
    class C,E,F,G,J agent;
    class D message;
    class K,L,M,N factory;
    class O,P util;

    linkStyle default stroke:#8fa7b8,stroke-width:1px,stroke-dasharray: 3 3;

    style Agents fill:#f8f0f4,stroke:#8fa7b8,stroke-width:1px,rx:5,ry:5;
    style Core fill:#e6f3ff,stroke:#8fa7b8,stroke-width:1px,rx:5,ry:5;
    style Factories fill:#f0f8f4,stroke:#8fa7b8,stroke-width:1px,rx:5,ry:5;